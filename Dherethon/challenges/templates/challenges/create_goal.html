{% load static %}
{% block content %}
<h2>인증글 작성</h2>

<div style="display: flex;">

    <!-- 왼쪽 프로필 -->
    <div style="width: 200px; margin-right: 20px;">
        <p><strong>{{ request.user.nickname }}</strong></p>
        <!-- 프로필 -->
        {% if user.profile_image and user.profile_image.url %}
            <img src="{{ user.profile_image.url }}" alt="프로필 이미지">
        {% else %}
            <img src="{% if user.profile_image %}{{ user.profile_image.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}" alt="프로필 이미지">
        {% endif %}

        <nav>
            <ul>
                <p><a href="{% url 'home:main' %}">홈</a></p>
                <p><a href="{% url 'challenges:my_challenges' %}">나의 도전</a></p>
                <p><a href="{% url 'community:post_list' %}">커뮤니티</a></p>
                <p><a href="{% url 'home:badge_list' %}">뱃지</a></p>
            </ul>
        </nav>
        <p><a href="{% url 'api:logout' %}">Log out</a></p>
    </div>

    <!-- 인증글 폼 -->
    <div style="flex: 2;">
        <p>[{{ challenge.category.name }}]</p>
        <h3>{{ challenge.title }}</h3>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- 세부 목표 선택 -->
            <label for="goal">세부 목표</label><br>
            <select name="goal" id="goal" required>
                <option value="">-- 세부 목표 선택 --</option>
                {% for g in all_goals %}
                    <option value="{{ g.id }}" {% if record and record.goal.id == g.id %}selected{% endif %}>
                        {{ g.content }}
                    </option>
                {% endfor %}
            </select><br><br>

            <!-- 날짜 -->
            <label for="date">날짜</label><br>
            <input type="date" name="date" id="date" value="{{ record.date|date:'Y-m-d' }}"><br><br>

            <!-- 이미지 -->
            <label for="image">인증 이미지</label><br>
            {% if record and record.image %}
                <img src="{{ record.image.url }}" width="200"><br>
            {% endif %}
            <input type="file" name="image" id="image"><br><br>

            <!-- 제목 -->
            <label for="title">제목</label><br>
            <input type="text" name="title" id="title" value="{{ record.title|default_if_none:'' }}"><br><br>

            <!-- 내용 -->
            <label for="content">내용</label><br>
            <textarea name="content" id="content" rows="6" cols="50">{{ record.content|default_if_none:'' }}</textarea><br><br>

            <!-- 버튼 -->
            <button type="submit">{% if record %}수정하기{% else %}등록하기{% endif %}</button>
        </form>
    </div>
</div>

<p><a href="{% url 'challenges:detail' challenge.id %}">← 도전 상세로 돌아가기</a></p>
{% endblock %}
