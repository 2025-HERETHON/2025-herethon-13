<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
{% load static %}
<h2>ğŸ“ ì¸ì¦ ê¸€ ê²Œì‹œí•˜ê¸°</h2>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <p><strong>ë„ì „ ì„ íƒ:</strong>
    <select id="challenge-select">
      <option value="">ë„ì „ì„ ì„ íƒí•˜ì„¸ìš”</option>
      {% for challenge in challenges %}
        <option value="{{ challenge.id }}">{{ challenge.title }}</option>
      {% endfor %}
    </select>
  </p>

  <p><strong>ì„¸ë¶€ ëª©í‘œ ì„ íƒ:</strong>
    <select name="goal" id="goal-select">
      <option value="">ë¨¼ì € ë„ì „ì„ ì„ íƒí•˜ì„¸ìš”</option>
    </select>
  </p>

  <div id="preview-container" style="display:none; margin-top: 20px;">
    <h4>ë¯¸ë¦¬ë³´ê¸°</h4>
    <p><strong>ë‚´ìš©:</strong> <span id="preview-content"></span></p>
    <p><strong>ì´ë¯¸ì§€:</strong><br><img id="preview-image" src="" alt="ì¸ì¦ ì´ë¯¸ì§€" width="200" style="display:none;"></p>
  </div>

  <button type="submit">ê²Œì‹œí•˜ê¸°</button>
</form>

<script>
  const challengeSelect = document.getElementById('challenge-select');
  const goalSelect = document.getElementById('goal-select');
  const previewContainer = document.getElementById('preview-container');
  const previewContent = document.getElementById('preview-content');
  const previewImage = document.getElementById('preview-image');

  challengeSelect.addEventListener('change', function () {
    const challengeId = this.value;
    fetch(`/community/load-goals/?challenge_id=${challengeId}`)
      .then(response => response.json())
      .then(data => {
        goalSelect.innerHTML = '<option value="">ì„¸ë¶€ ëª©í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
        data.forEach(goal => {
          const option = document.createElement('option');
          option.value = goal.id;
          option.textContent = goal.content;
          option.dataset.content = goal.content;
          option.dataset.image = goal.image_url;
          goalSelect.appendChild(option);
        });
      });
  });

  goalSelect.addEventListener('change', function () {
    const selectedOption = this.options[this.selectedIndex];
    const content = selectedOption.dataset.content;
    const imageUrl = selectedOption.dataset.image;

    previewContent.textContent = content || '';

    if (imageUrl) {
      previewImage.src = imageUrl;
      previewImage.style.display = 'block';
    } else {
      previewImage.style.display = 'none';
    }

    previewContainer.style.display = 'block';
  });
</script>

</body>
</html>
